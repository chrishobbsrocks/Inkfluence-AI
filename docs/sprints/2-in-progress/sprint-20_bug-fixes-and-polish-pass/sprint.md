# Sprint 20: Bug Fixes and Polish Pass

## Overview

| Field | Value |
|-------|-------|
| Sprint | 20 |
| Title | Bug Fixes and Polish Pass |
| Epic | None (standalone) |
| Status | Planning |
| Created | 2026-02-13 |
| Started | - |
| Completed | - |

## Goal

Fix all known bugs and polish issues discovered during end-to-end testing of the Core Product. This sprint addresses critical data flow issues, broken navigation, AI output quality, and visual inconsistencies.

## Background

After completing all 19 feature sprints, end-to-end testing revealed several bugs and polish issues that need to be resolved before the product is shippable. These range from critical data flow bugs to cosmetic issues.

## Requirements

### Critical Bugs

- [ ] **Wizard stepper shows "Review" during outline generation**: The stepper jumps to step 5 (Review) when outline generation is triggered. It should stay on step 4 (Outline) with loading state, then advance to step 5 (Review) only after the outline is fully generated and ready for user review.

- [ ] **Wizard data doesn't flow to downstream tools**: The outline generated by the Knowledge Wizard doesn't properly connect to the Outline Editor and Chapter Editor. Root cause: missing server action that converts outlineSections -> chapters when user clicks "Continue to Writing". Fix requires:
  - Create server action in src/server/actions/ that queries outlineSections for the book's outlineId
  - For each section, insert a chapters record (title <- chapterTitle, orderIndex <- orderIndex, bookId, status <- "outline", content <- null, wordCount <- 0)
  - Update book status from draft -> writing
  - Navigate to the editor after conversion
  - Add idempotency guard: skip if chapters already exist for this book
  - Validate outline has at least 1 section before allowing conversion
  - Wire this action to the "Continue to Writing ->" button in src/components/outline/outline-editor-wrapper.tsx

- [ ] **"Next Chapter" button does nothing**: Clicking "Next Chapter ->" in the chapter editor has no effect. The button needs to:
  - Find the next chapter by orderIndex for the current book
  - Navigate to /books/[bookId]/editor?chapter=[nextChapterId]
  - If on the last chapter, disable the button or show "Go to Preview ->" instead
  - Also add a "Previous Chapter" button or back navigation

### AI Output Quality

- [ ] **Remove AI fingerprints from all generated content**: Update every system prompt in src/lib/ai/prompts/ with these rules:
  - Never use em dashes. Use dashes (-) if a pause is needed.
  - Never use phrases: "In today's world", "It's important to note", "Let's dive in", "In conclusion", "In this chapter"
  - No filler transitions in sequence: "Furthermore", "Moreover", "Additionally"
  - No overly formal hedging: "It's worth mentioning that", "It should be noted"
  - Write like a human expert having a conversation, not an AI producing content
  - Use short punchy sentences mixed with longer ones for natural rhythm
  - Use contractions (don't, won't, can't)
  - No bullet point lists unless the user's outline specifically calls for them
  - Applies to ALL prompts: Knowledge Wizard (Sprint 6), Content Generation (Sprint 11), QA Analysis (Sprint 15), Metadata Generation (Sprint 17)

### Visual Polish

- [ ] **Logo doesn't match wireframe**: The Inkfluence AI logo needs to match the wireframe spec exactly (lines 37-42 of inkfluence-ai-hifi-wireframes.jsx):
  - Icon container: w-7 h-7 rounded-lg bg-stone-900 (solid fill, no border/outline)
  - Icon: BookOpen from Lucide, w-3.5 h-3.5 text-white
  - Text: "Inkfluence" in font-semibold text-sm text-stone-900 using Instrument Serif font family
  - "AI" after it in text-stone-400 font-normal
  - Layout: flex items-center gap-2, compact

- [ ] **Next.js middleware deprecation warning**: The "middleware" file convention is deprecated in Next.js 16. Migrate to use "proxy" convention per https://nextjs.org/docs. Not blocking but should be cleaned up.

## Dependencies

- **Sprints**: All feature sprints complete (1-19)
- **External**: None

## Scope

### In Scope

- All bugs listed above
- Any additional bugs discovered during fix verification

### Out of Scope

- New features
- Performance optimization
- Mobile responsiveness

## Tasks

### Team 1 (UI & Data Flow)
- [ ] Fix wizard stepper state (stay on step 4 during generation)
- [ ] Create outlineSections -> chapters server action
- [ ] Wire "Continue to Writing" button to new server action
- [ ] Fix "Next Chapter" navigation in chapter editor
- [ ] Fix logo to match wireframe spec
- [ ] Fix middleware deprecation warning

### Team 2 (AI Prompts)
- [ ] Update Knowledge Wizard system prompts (remove AI fingerprints)
- [ ] Update Content Generation prompts (remove em dashes, filler phrases)
- [ ] Update QA Analysis prompts
- [ ] Update Metadata Generation prompts
- [ ] Test generated content for AI artifacts

### Verification (Both Teams)
- [ ] Full end-to-end walkthrough: Sign up -> Wizard -> Outline -> Editor -> Preview -> Export -> QA -> Publish
- [ ] Verify data flows correctly between all tools
- [ ] Verify no em dashes or AI phrases in newly generated content
- [ ] Verify logo matches wireframe
- [ ] Verify all navigation works (Next Chapter, Continue to Writing, etc.)
- [ ] Verify Vercel deployment builds successfully

## Acceptance Criteria

- [ ] Wizard stepper shows correct step during outline generation
- [ ] "Continue to Writing" creates chapters from outline sections in database
- [ ] "Next Chapter" navigates to the next chapter in order
- [ ] Generated content contains zero em dashes
- [ ] Generated content sounds human-written, not AI-generated
- [ ] Logo matches wireframe spec exactly
- [ ] No middleware deprecation warnings in build
- [ ] Full end-to-end user flow works without errors
- [ ] Vercel build passes clean

## Notes

This sprint can be split between both teams since the bugs span UI (Team 1) and AI (Team 2) domains. Both teams work in parallel - no dependencies between the bug fixes.
