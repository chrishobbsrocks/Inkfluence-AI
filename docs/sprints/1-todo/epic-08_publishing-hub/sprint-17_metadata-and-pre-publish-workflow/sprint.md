# Sprint 17: Metadata and Pre-publish Workflow

## Overview

| Field | Value |
|-------|-------|
| Sprint | 17 |
| Title | Metadata and Pre-publish Workflow |
| Epic | 8 - Publishing Hub |
| Status | Planning |
| Created | 2026-02-13 |
| Started | - |
| Completed | - |

## Goal

Build the pre-publish checklist, automated metadata generation, and metadata editing interface.

## Background

Before publishing, several things need to be verified: all chapters complete, QA passed, cover finalized, and metadata ready. The metadata (description, keywords, categories, pricing) is auto-generated by AI but fully editable by the user.

## Requirements

### Functional Requirements

- [ ] Pre-publish checklist with 4 items: chapters complete, QA passed, cover finalized, metadata complete
- [ ] Each item shows status (done/not done) with description
- [ ] "Complete →" button for incomplete items (navigates to relevant page)
- [ ] Auto-generated book description using Claude
- [ ] Auto-generated keywords (tags)
- [ ] Auto-generated category suggestion
- [ ] Price input field (default $9.99)
- [ ] All metadata fields editable
- [ ] Save metadata to database
- [ ] Badge showing "Auto-generated" on AI-generated fields

### Non-Functional Requirements

- [ ] Checklist validates actual state (not just user-toggled)
- [ ] Metadata generation under 10 seconds
- [ ] Keywords limited to 7 (Amazon KDP limit)

## Dependencies

- **Sprints**: Sprint 15 (QA scores for checklist), Sprint 14 (export for formats), Sprint 6 (Claude API for metadata generation)
- **External**: None

## Scope

### In Scope

- Publishing page first section (checklist + metadata)
- Pre-publish validation logic
- AI metadata generation
- Metadata editing UI
- Database persistence for metadata

### Out of Scope

- Platform management UI (Sprint 18)
- Actual publishing submission

## Technical Approach

### Reference: Wireframe PublishScreen (lines 557-656)

### Checklist Validation
Each item checks real state:
1. Chapters complete: all chapters have status "complete" and word_count > 0
2. QA passed: latest QA score >= 70
3. Cover finalized: cover_url is not null
4. Metadata complete: all metadata fields filled

### Metadata Generation
Send book title + outline + first paragraph of each chapter to Claude:
"Generate publishing metadata for this book: 1) 150-word description 2) 7 keywords 3) Category path"

### Data Model Addition
```
book_metadata: id, book_id, description, keywords (jsonb), category, price, currency, created_at, updated_at
```

## Tasks

### Phase 2: Implementation
- [ ] Add book_metadata table to schema and migrate
- [ ] Create publish page at /books/[bookId]/publish
- [ ] Create PrePublishChecklist component (4 items with validation)
- [ ] Implement checklist validation logic (query actual state)
- [ ] Create MetadataEditor component (description, keywords, category, price)
- [ ] Build AI metadata generation API route
- [ ] Design and test metadata generation prompt
- [ ] Implement auto-generate on page load (if no metadata exists)
- [ ] Add "Auto-generated" badges
- [ ] Save metadata on edit
- [ ] Wire "Complete →" buttons to navigate to relevant pages

## Acceptance Criteria

- [ ] Pre-publish checklist shows 4 items with real validation state
- [ ] Incomplete items show "Complete →" button that navigates correctly
- [ ] AI generates book description, keywords, and category
- [ ] All metadata fields editable
- [ ] "Auto-generated" badge visible on AI-generated fields
- [ ] Metadata saves to database
- [ ] Keywords limited to 7
- [ ] Price defaults to $9.99
- [ ] UI matches wireframe checklist and metadata sections (lines 572-624)

## Notes

Wireframe reference: PublishScreen lines 557-656, specifically the checklist (lines 572-594) and metadata card (lines 596-624).
